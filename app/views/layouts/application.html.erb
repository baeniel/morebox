<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Morebox</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag 'application', media: 'all' %>
    <%= stylesheet_link_tag 'sweetalert.min' %>
    <%= javascript_pack_tag 'application' %>
    <%# javascript_include_tag 'application' %>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
  </head>

  <body id="change-color" style="text-align: center;">
    <style>
      .text-red{
        color: red;
      }
      .bg-color-primary{
        background-color: #757CFF;
      }
      .color-primary{
        color: #757CFF;
      }
    </style>
  <% if notice %>
      <div class="alert alert-shape alert-color mt-4">
        <span class="badge badge-dark badge-pill">
          알림
        </span>
        <span class="alert-content text-white"><%= notice %></span>
      </div>
    <% end %>
    <%#= render 'shared/header' %>
    <% if current_user %>
      <div class="row justify-content-end px-5">
        <h3 class="text-red p-3">
          <a href="#" onclick="initTimer();return false;">
            <i class="fas fa-redo" style="color:red;"></i> 
          </a>
          <span class="left-time pl-2"></span>
        </h3>
      </div>
    <% end %>
    
    <%= yield %>
    <%#= render 'shared/footer' %>
  </body>
</html>

<script>
  <% if current_user %>
    var currentUser = <%= raw current_user.to_json %>;
    window.createChannel(currentUser);
    // 5분후 자동 로그아웃
    function initTimer(){
      var closeSeconds = 300;
      $(".left-time").text(`5분 00초 후에 자동 로그아웃 됩니다.`);
      clearInterval(window.intervalId);
      window.intervalId = setInterval(function () {
        closeSeconds--;
        if (closeSeconds < 0) {
          clearInterval(window.intervalId);
        }
        $(".left-time").text(`${parseInt(closeSeconds/60)}분 ${closeSeconds%60}초 후에 자동 로그아웃 됩니다.`);

      }, 1000);

      console.log("count down start")
      clearTimeout(window.timeOutId)
      window.timeOutId = setTimeout(function () {
                          window.location = '/items/auto_out'
                        }, closeSeconds * 1000);
                        
    }
    
    initTimer();
  <% end %>
  $(document).ready(function() {
    $(".alert").fadeTo(2000, 2500).slideUp(1000, function() { });
  });
</script>
